<!DOCTYPE html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.1/lib/p5.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <meta charset="utf-8" />
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: row-reverse;
      align-items: flex-start;
      justify-content: space-evenly;

    }


    #graph_container {
      width: 50%;
      height: max-content;
      min-height: 200px;
    }

    .choice_list {
      width: 100%;
      height: max-content;
      display: flex;
      align-items: flex-start;
      flex-direction: row;
      flex-wrap: wrap;

    }

    .step {
      width: 40px;
      height: 40px;
      display: flex;
      flex-wrap: wrap;
      flex-direction: column;
      align-content: space-between;
      justify-content: space-between;
    }

    ul.selected {
      width: 40px;
      height: 40px;
      display: flex;
      flex-wrap: wrap;
      flex-direction: column;
      align-content: space-between;
      justify-content: space-between;
      margin-right: 20px;
    }

    li {
      width: 12px;
      height: 12px;
      display: inline-block;
      background-color: #fff;
      border: 1px solid gray;
      box-sizing: border-box;
      border-radius: 3px;
      padding: 0;
      margin: 0;


    }

    li.fillX {
      background-color: rgb(248, 123, 250);
    }

    li.fillO {
      background-color: aqua;
    }

    li.active {
      background-color: rgb(136, 0, 0);
      border: 1px solid rgb(136, 0, 0);
    }

    li.selected {
      background-color: rgb(3, 130, 15);
      border: 1px solid rgb(3, 130, 15);
    }

    .config_container {
      width: 100%;
      position: absolute;
      height: max-content;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: gray;
      bottom: 0;
    }

    .config_container>div>label {
      margin-left: 30px;
    }
    #restart_btn{
      align-self: flex-end;
      margin: 0 30px;
      padding: 8px 15px;
    }
  </style>
</head>

<body>
  <div class="config_container">
    <div><label>start with user: </label>
      <input id="startWithUser" type="checkbox" /></div>
    <button id="restart_btn" >restart</button>
  </div>

  <div id="graph_container">

  </div>
  <script>


    $("#restart_btn").on("click" , ()=>{

      location.reload();
    })

    function addStep(board, i, j) {
      function getCellClass(value) {
        let res = ''
        switch (value.toUpperCase()) {
          case 'X':
            res = "fillX"
            break;
          case 'O':
            res = "fillO";
            break
          default:
            res = ""
        }

        return res
      }

      const selectedNum = (i * 3) + j;



      const flatBoard = board.flat();


      let list = $('<div>').addClass('choice_list');


      for (let allCel in flatBoard) {
        let elementList = []

        for (let cel in flatBoard) {

          let li = document.createElement('li');
          let activeClass = cel == allCel ? "active" : ''
          console.log(flatBoard[cel])
          let fillClass = getCellClass(flatBoard[cel])

          li.className = fillClass + " " + activeClass



          elementList.push(li)
        }

        const ul = $('<ul>').addClass('step').append(elementList);

        let selectedUl = undefined;
        if (allCel == 0) {
          let liListSelected = []
          for (let cel in flatBoard) {
            console.log(cel, selectedNum)
            let liSelect = document.createElement('li');

            let selectedFill = cel == selectedNum ? "selected" : ''
            let fillClass2 = flatBoard[cel] !== '' ? "fill" : ''
            liSelect.className = fillClass2 + " " + selectedFill



            liListSelected.push(liSelect)
          }
          selectedLi = $('<ul>').addClass('selected').append(liListSelected);
        }

        if (selectedLi)
          list.prepend(selectedLi)

        if (flatBoard[allCel] == "")
          list.append(ul)
      }

      $(list).appendTo(`#graph_container`)


      $("#startWithUser").on('click',
        function (e) {
          const isChecked = e.target.checked;
          localStorage.setItem('isUser', isChecked)
        })


      $(document).ready(function () {
        const isUser = localStorage.getItem("isUser") === "true" ? true : false
        if (isUser == true)
          $("#startWithUser").prop('checked', true);
        else
          $("#startWithUser").prop('checked', false);
      });

    }
  </script>
  <script src="minimax.js"></script>
  <script src="sketch.js"></script>
</body>

</html>